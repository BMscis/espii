<!DOCTYPE html>
<html>
    <head>
            <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1" lang="eng-us">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <link href="https://fonts.googleapis.com/css?family=Fascinate+Inline|Fira+Sans|Inconsolata|Modak&display=swap" rel="stylesheet"> 
            <link name='icon' rel="icon" type="image/icon type">
            <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >


    </head>
    <title >
        Cloud Monitoring
    </title>
    <body>
        <button id = 'cd'>click</button>
        <p id='pe'></p>
   
    <?php
    $request_url = "https://api.acrcloud.com/v1/acrcloud-monitor-streams/246132/results?access_key=c17c66b0e3be50dcb93cb319ac84709c&date=20200208/callback";
    $http_method = 'POST';
    $http_uri = '/v1/acrcloud-monitor-stream/c17c66b0e3be50dcb93cb319ac84709c/callback';
    $timestamp = time();
    $signature_version = '1';
    /*
    This demo shows how to use the RESTful API to upload an audio file ( "data_type":"audio" ) into your bucket.
    You can find account_access_key and account_access_secret in your account page.
    Log into http://console.acrcloud.com -> "Account" (top right corner) -> "RESTful API Keys" -> "Create Key Pair". 
    Be Careful, they are different with access_key and access_secret of your project.
    */
    $account_access_key = 'cd4893be9a208bad';
    $account_access_secret = '	c296085ded4bc06bd93eb09638e30c09';

    $string_to_sign = $http_method . "\n" .
                      $http_uri ."\n" .
                      $account_access_key . "\n" .
                      $signature_version . "\n" .
                      $timestamp;
    $signature = hash_hmac("sha1",$string_to_sign,$account_access_secret,true);
    $signature = base64_encode($signature);

    $postfields = array(
        'callback_url' => 'http://espii.club/platform.html',
        'post_type' =>'json'
    );
    $headerArray = array();
    $headers = array(
        'access-key' => $account_access_key,
        'timestamp' => $timestamp,
        'signature-version' => '1',
        'signature' => $signature
    );
    foreach( $headers as $n => $v ) {
        $headerArr[] = $n .':' . $v;
    }
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $request_url);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $postfields);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headerArr);
    $response = curl_exec($ch);
    var_dump($response);
    curl_close($ch);
    ?>
    
<?php
$stream_id = "246132";
$account_access_key = 'cd4893be9a208bad';
$account_access_secret = 'c296085ded4bc06bd93eb09638e30c09';
$request_url = 'https://api.acrcloud.com/v1/monitor-streams/'.$stream_id;
$http_method = 'GET';
$http_uri = "/v1/monitor-streams/".$stream_id;
$timestamp = time();
$signature_version = '1';


$string_to_sign = $http_method . "\n" .
                  $http_uri ."\n" .
                  $account_access_key . "\n" .
                  $signature_version . "\n" .
                  $timestamp;
$signature = hash_hmac("sha1",$string_to_sign,$account_access_secret,true);
$signature = base64_encode($signature);

$headerArray = array();
$headers = array(
    'access-key' => $account_access_key,
    'timestamp' => $timestamp,
    'signature-version' => '1',
    'signature' => $signature
);
foreach( $headers as $n => $v ) {
    $headerArr[] = $n .':' . $v;
}

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $request_url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_HTTPHEADER, $headerArr);
$response = curl_exec($ch);
var_dump($response);
curl_close($ch);
?>
    </body>